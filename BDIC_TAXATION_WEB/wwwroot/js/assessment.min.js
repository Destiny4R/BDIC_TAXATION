function _getbtnproperty(n){return n?"btn-reject":"btn-approve"}function rejectAndApprove(n){const t=Swal.mixin({customClass:{confirmButton:"btn btn-success",cancelButton:"btn btn-danger"},buttonsStyling:!1});t.fire({title:"Are you sure?",text:"You want to reject this request!",icon:"warning",showCancelButton:!0,confirmButtonText:"Yes!",cancelButtonText:"No, cancel!",reverseButtons:!0}).then(i=>{i.isConfirmed?$.ajax({type:"POST",url:"/v1/RejectTaxRequest",data:{id:n,isoption:!0},success:function(n){$.unblockUI();n.success?(t.fire("Information!",n.message,"success"),table.ajax.reload(null,!1)):Swal.fire({icon:"error",title:"Oops...",text:n.message,footer:"Message"})},beforeSend:function(){blockcallback()},error:function(){$.unblockUI();Swal.fire({icon:"error",title:"Oops...",text:"Something went wrong!",footer:"Check internet connectivity"})},complete:function(){$.unblockUI()}}):i.dismiss===Swal.DismissReason.cancel&&t.fire("Cancelled","Action aborted","error")})}function blockcallback(){$.blockUI({message:'<div class="bs-spinner mt-4 mt-lg-0"><div class= "spinner-border text-success mr-2 mt-2" style="width: 10rem; height: 10rem;" role="status"><span class="sr-only">Loading...<\/span><\/div> ',fadeIn:800,overlayCSS:{backgroundColor:"#1b2024",opacity:.8,zIndex:1200,cursor:"wait"},css:{border:0,color:"#fff",zIndex:1201,padding:0,backgroundColor:"transparent"},onBlock:function(){}})}var table=null;$(document).ready(function(){table=$("#assessmentTable").DataTable({serverSide:!0,processing:!0,searching:!0,paging:!0,info:!0,responsive:!0,ajax:{url:"/view/TaxAssessmentViews",type:"POST",dataType:"json"},columns:[{data:null,orderable:!1,searchable:!1,autoWidth:!0,render:function(n,t,i,r){return r.settings._iDisplayStart+r.row+1}},{data:"companyname",autoWidth:!0},{data:"username",autoWidth:!0},{data:"session",autoWidth:!0},{data:"session",autoWidth:!0,render:function(n){let t=Number(n);return t+1+", Dec"}},{data:"createdate",autoWidth:!0,render:function(n){if(n!=null){var t=new Date(n).getHours();let i=t>=12?"pm":"am";return n=n.toLocaleString("YYYY-MM-dd").slice(0,19).replace("T"," ")+" "+i}return"null"}},{data:"income",autoWidth:!0},{data:"taxamount",autoWidth:!0},{data:"status",autoWidth:!0,render:function(n){return n?'<span class="badge badge-success"><i class="far fa-thumbs-up"><\/i><\/span>':'<span class="badge badge-warning"><i class="far fa-thumbs-down"><\/i><\/span>'}},{data:null,orderable:!1,render:function(n){let t="Reject",i="mdi-close-circle-outline";n.status||(t="Approve",i="mdi-check-underline-circle-outline");var r=$("<div>").addClass("btn-group"),f=$("<button>").attr("type","button").addClass("btn btn-light").attr("data-bs-toggle","dropdown").append($("<i>").addClass("mdi mdi-dots-horizontal")),u=$("<ul>").addClass("dropdown-menu"),e=[{icon:"mdi-eye-circle-outline",text:"View",className:"btn-view"},{icon:i,id:"theactiontag",text:t,className:_getbtnproperty(n.status),toggleClass:"btn-download"},{icon:"mdi-flag-outline",text:"Flag",className:"btn-reject"}];return $.each(e,function(t,i){var r=$("<a>").addClass("dropdown-item "+i.className).attr("href","#").attr("data-id",n.id);i.id&&r.attr("id",i.id);r.append($("<i>").addClass("mdi "+i.icon),document.createTextNode(" "+i.text));i.attrs&&r.attr(i.attrs);$("#theactiontag").toggleClass(`${i.className} ${i.toggleClass}`);u.append($("<li>").append(r))}),r.append(f).append(u),r[0].outerHTML}}],language:{processing:'<i class="fa fa-spinner fa-spin fa-3x fa-fw"><\/i><span class="sr-only">Loading...<\/span>',lengthMenu:"Show _MENU_ entries",zeroRecords:"No matching records found",info:"Showing _START_ to _END_ of _TOTAL_ entries",infoEmpty:"Showing 0 to 0 of 0 entries",infoFiltered:"(filtered from _MAX_ total entries)",search:"Search:",paginate:{first:'<i class="fas fa-angle-left"><\/i>',last:'<i class="fas fa-angle-right"><\/i>',next:"Next",previous:"Prev"}},initComplete:function(){console.log("Table initialized")}})});$(document).on("click",".btn-approve",function(){const n=$(this).data("id");rejectAndApprove(n)});$(document).on("click",".btn-view",function(){const n=$(this).data("id");$.ajax({type:"POST",url:"/v1/GetTaxAssessmentedata/"+n,success:function(n){var t,i,r,u;if($.unblockUI(),n.success){t=n.data;$("#name").text(t.companyname);$("#assetname").text(t.username);$("#session").text(t.session);$("#income").text(t.income);$("#phone").text(t.phone);$("#taxamount").text(t.taxamount);$("#btn-download").text(t.filepath);$("#leftamount").text(t.amountleft);const o=new Date(t.createdate),s=o.toLocaleString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit",hour12:!0});$("#createdate").text(s);$(".btn-download").attr("data-id",t.id);i=$(".btn-approve");i.empty();r=$("<i>").addClass("mdi");u=$("<span>");t.status?(i.addClass("btn-danger").attr("data-id",t.id),r.addClass("mdi-close-circle-outline"),u.text(" Reject")):(i.addClass("btn-success").attr("data-id",t.id),r.addClass("mdi-check-underline-circle-outline"),u.text(" Approve"));i.append(r,u);$("#docu-name").text(typeof t.filename=="string"?t.filename.trim():"");const f=$("#div-download").empty();if(t.filepath){const n=$("<a>",{href:encodeURI(t.filepath.startsWith("/")?t.filepath:"/"+t.filepath),target:"_blank","class":"btn btn-sm btn-light w-100 btn-download",title:"Download document","aria-label":"Download document"}).append($("<i>",{"class":"dripicons-download mr-1"}));f.html(n)}else f.html('<span class="text-muted">No document available<\/span>');const e=$("#divmessage").empty();t.status?e.append('<strong>Status: <\/strong> <span class="badge badge-success"><i class="fas fa-check-double"><\/i><\/span>'):e.append('<strong>Status: <\/strong> <span class="badge badge-danger"><i class="fas fa-times"><\/i><\/span>');const h=new bootstrap.Modal("#assessmentDetailsModal");h.show()}else Swal.fire({icon:"error",title:"Oops...",text:n.message,footer:"Message"})},beforeSend:function(){blockcallback()},error:function(){$.unblockUI();Swal.fire({icon:"error",title:"Oops...",text:"Something went wrong!",footer:"Check internet connectivity"})},complete:function(){$.unblockUI()}})});$(document).on("click",".btn-reject",function(){const n=$(this).data("id");Swal.fire({title:"Submit Rejection Message",html:`
        <div class="form-group text-left">
            <label for="statusSelect" class="d-block text-left">Select Status:</label>
            <select id="statusSelect" class="custom-select">
                <option value="" selected disabled>-- Select an option --</option>
                <option value="Flagged by legal">Flagged by legal</option>
                <option value="Active">Active</option>
                <option value="Closed">Closed</option>
            </select>
        </div>
        <div class="form-group text-left">
            <label for="rejectReason" class="d-block text-left">Enter reason for rejection:</label>
            <textarea id="rejectReason" class="form-control" rows="5" placeholder="Enter reason for rejection..." maxlength="500"></textarea>
        </div>
    `,preConfirm:async()=>{const t=document.getElementById("rejectReason").value,i=document.getElementById("statusSelect").value;if(!i)return Swal.showValidationMessage("Please select an option"),!1;if(!t)return Swal.showValidationMessage("Message cannot be empty"),!1;try{const r=`/v1/RejectTaxRequest?id=${n}&reason=${t}&status=${i}`;$.ajax({type:"POST",url:r,data:{id:n,reason:t,status:i,isoption:!1},success:function(n){$.unblockUI();Swal.fire({title:"Reason Submitted",text:n.message,icon:n.success?"success":"error"})},error:function(){$.unblockUI();Swal.fire({icon:"error",title:"Oops...",text:"Something went wrong!",footer:"Check internet connectivity"})},complete:function(){$.unblockUI()}})}catch(r){return Swal.showValidationMessage(`Request failed: ${r}`),!1}},showCancelButton:!0,confirmButtonText:"Submit",showLoaderOnConfirm:!0,allowOutsideClick:()=>!Swal.isLoading()})});